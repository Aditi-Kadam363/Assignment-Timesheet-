<!DOCTYPE html>
<html>
<head>
  <title>Timesheet</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="container mt-5">

  <h2>Timesheet</h2>
  <input id="date" type="date" class="form-control mb-2">
  <input id="hours" type="number" class="form-control mb-2" placeholder="Hours Worked">
  <input id="task" class="form-control mb-2" placeholder="Task Description">
<button id="addBtn" onclick="addOrUpdateTimesheet()" class="btn btn-primary">Add</button>


  <h3 class="mt-4">Your Timesheets</h3>
  <table class="table" id="timesheetTable">
    <thead><tr><th>Date</th><th>Hours</th><th>Task</th><th>Actions</th></tr></thead>
    <tbody></tbody>
  </table>

<script>
let employeeId = localStorage.getItem("employeeId");

async function loadTimesheets(){
  let res = await fetch(`https://localhost:7065/api/timesheet/${employeeId}`);
  let data = await res.json();
  let tbody = document.querySelector("#timesheetTable tbody");
  tbody.innerHTML="";
  data.forEach(t=>{
    tbody.innerHTML+= `<tr>
      <td>${t.date}</td>
      <td>${t.hoursWorked}</td>
      <td>${t.taskDescription}</td>
      <td>
        <button class="btn btn-warning btn-sm" onclick="editTimesheet(${t.timesheetId}, '${t.date}', ${t.hoursWorked}, '${t.taskDescription}')">Edit</button>
        <button onclick="deleteTimesheet(${t.timesheetId})" class="btn btn-danger btn-sm">Delete</button>
      </td>
    </tr>`;
  });
}

async function addTimesheet(){
  await fetch("https://localhost:7065/api/timesheet", {
    method:"POST",
    headers:{ "Content-Type":"application/json" },
    body: JSON.stringify({
      employeeId: employeeId,
      date: date.value,
      hoursWorked: hours.value,
      taskDescription: task.value
    })
  });
  loadTimesheets();
}
//edit part
let editingId = null; // Track which timesheet we are editing

function editTimesheet(id, date, hours, task) {
  editingId = id; // store the ID being edited

  // Prefill the form fields
  document.getElementById("date").value = date.split("T")[0]; 
  document.getElementById("hours").value = hours;
  document.getElementById("task").value = task;

  // Change button text to Update
  document.getElementById("addBtn").innerText = "Update";
}

async function addOrUpdateTimesheet() {
  let sheet = {
    employeeId: localStorage.getItem("employeeId"),
    date: document.getElementById("date").value,
    hoursWorked: document.getElementById("hours").value,
    taskDescription: document.getElementById("task").value
  };

  if (editingId) {
    // Update existing timesheet
    let res = await fetch(`https://localhost:7065/api/timesheet/${editingId}`, {
      method: "PUT",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(sheet)
    });
    if (res.ok) {
      alert("Updated Successfully");
      editingId = null;
      document.getElementById("addBtn").innerText = "Add";
      loadTimesheets();
    }
  } else {
    // Add new timesheet
    let res = await fetch("https://localhost:7065/api/timesheet", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(sheet)
    });
    if (res.ok) {
      alert("Added Successfully");
      loadTimesheets();
    }
  }

  // Clear inputs
  document.getElementById("date").value = "";
  document.getElementById("hours").value = "";
  document.getElementById("task").value = "";
}


async function deleteTimesheet(id){
  await fetch(`https://localhost:7065/api/timesheet/${id}`, { method:"DELETE" });
  loadTimesheets();
}

loadTimesheets();
</script>
</body>
</html>
